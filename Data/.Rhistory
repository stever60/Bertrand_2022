install.packages(c("alphavantager", "bayesm", "bayestestR", "bestNormalize", "BH", "bit", "blob", "boot", "brew", "broom",
"bslib", "butcher", "cachem", "callr", "car", "checkmate", "class", "cli", "cluster", "codetools",
"colorspace", "colourpicker", "commonmark", "compositions", "cpp11", "crayon", "curl", "data.table",
"datawizard", "DBI", "dbplyr", "deldir", "dendextend", "DEoptimR", "desc", "devtools", "digest", "doRNG",
"dplyr", "DT", "dtplyr", "e1071", "effectsize", "ellipse", "errors", "evaluate", "FactoMineR",
"fansi", "farver", "fastmap", "fontawesome", "forcats", "forecast", "foreign", "Formula",
"fracdiff", "fs", "furrr", "future", "future.apply", "gargle", "generics", "gert", "ggcorrplot",
"ggfortify", "ggplot2", "ggpubr", "ggrepel", "ggsci", "ggsignif", "ggstance", "gh", "gitcreds",
"globals", "googledrive", "googlesheets4", "gower", "greybox", "gtable", "hardhat", "haven", "highr",
"Hmisc", "hms", "htmlTable", "htmltools", "htmlwidgets", "httpuv", "httr", "insight", "IntCal", "ipred",
"isoband", "itraxR", "janitor", "jpeg", "jsonlite", "KernSmooth", "knitr", "LambertW", "lamW", "later",
"lattice", "latticeExtra", "lava", "lifecycle", "listenv", "lme4", "lobstr", "lubridate", "maptools",
"MASS", "Matrix", "MatrixModels", "mclust", "mgcv", "minqa", "mnormt", "modelr", "nlme", "nnet", "openssl",
"ordr", "padr", "parallelly", "parameters", "patchwork", "pbkrtest", "pcaPP", "performance", "pillar",
"pkgbuild", "pkgload", "pls", "plyr", "png", "polyclip", "pracma", "processx", "prodlim", "progressr",
"proxy", "ps", "psych", "purrr", "quantmod", "quantreg", "R.cache", "R.methodsS3", "R.oo", "R.utils",
"rbacon", "rcarbon", "Rcpp", "RcppArmadillo", "RcppEigen", "RcppParallel", "readr", "readxl", "recipes",
"repr", "reprex", "rioja", "rlang", "rmarkdown", "robustbase", "roxygen2", "rpart", "rsample", "rstatix",
"rstudioapi", "rversions", "rvest", "sass", "scales", "scatterplot3d", "see", "shiny", "slider", "smooth",
"sourcetools", "sp", "spatial", "spatstat", "spatstat.data", "spatstat.geom", "spatstat.linnet",
"spatstat.random", "spatstat.sparse", "spatstat.utils", "statmod", "stringi", "stringr", "styler",
"survival", "sys", "testthat", "tibble", "tidypaleo", "tidyquant", "tidyr", "tidyselect", "tidyverse",
"timeDate", "timetk", "tinytex", "tseries", "tsfeatures", "tzdb", "urca", "usethis", "utf8", "vctrs",
"vegan", "viridis", "viridisLite", "vroom", "waldo", "whisker", "xfun", "xml2", "xts", "yaml", "zip"))
install.packages(c("alphavantager", "bayesm", "bayestestR", "bestNormalize", "BH", "bit", "blob", "boot", "brew", "broom", "bslib", "butcher", "cachem", "callr", "car", "checkmate", "class", "cli", "cluster", "codetools", "colorspace", "colourpicker", "commonmark", "compositions", "cpp11", "crayon", "curl", "data.table", "datawizard", "DBI", "dbplyr", "deldir", "dendextend", "DEoptimR", "desc", "devtools", "digest", "doRNG", "dplyr", "DT", "dtplyr", "e1071", "effectsize", "ellipse", "errors", "evaluate", "FactoMineR", "fansi", "farver", "fastmap", "fontawesome", "forcats", "forecast", "foreign", "Formula", "fracdiff", "fs", "furrr", "future", "future.apply", "gargle", "generics", "gert", "ggcorrplot", "ggfortify", "ggplot2", "ggpubr", "ggrepel", "ggsci", "ggsignif", "ggstance", "gh", "gitcreds", "globals", "googledrive", "googlesheets4", "gower", "greybox", "gtable", "hardhat", "haven", "highr", "Hmisc", "hms", "htmlTable", "htmltools", "htmlwidgets", "httpuv", "httr", "insight", "IntCal", "ipred", "isoband", "itraxR", "janitor", "jpeg", "jsonlite", "KernSmooth", "knitr", "LambertW", "lamW", "later", "lattice", "latticeExtra", "lava", "lifecycle", "listenv", "lme4", "lobstr", "lubridate", "maptools", "MASS", "Matrix", "MatrixModels", "mclust", "mgcv", "minqa", "mnormt", "modelr", "nlme", "nnet", "openssl", "ordr", "padr", "parallelly", "parameters", "patchwork", "pbkrtest", "pcaPP", "performance", "pillar", "pkgbuild", "pkgload", "pls", "plyr", "png", "polyclip", "pracma", "processx", "prodlim", "progressr", "proxy", "ps", "psych", "purrr", "quantmod", "quantreg", "R.cache", "R.methodsS3", "R.oo", "R.utils", "rbacon", "rcarbon", "Rcpp", "RcppArmadillo", "RcppEigen", "RcppParallel", "readr", "readxl", "recipes", "repr", "reprex", "rioja", "rlang", "rmarkdown", "robustbase", "roxygen2", "rpart", "rsample", "rstatix", "rstudioapi", "rversions", "rvest", "sass", "scales", "scatterplot3d", "see", "shiny", "slider", "smooth", "sourcetools", "sp", "spatial", "spatstat", "spatstat.data", "spatstat.geom", "spatstat.linnet", "spatstat.random", "spatstat.sparse", "spatstat.utils", "statmod", "stringi", "stringr", "styler", "survival", "sys", "testthat", "tibble", "tidypaleo", "tidyquant", "tidyr", "tidyselect", "tidyverse", "timeDate", "timetk", "tinytex", "tseries", "tsfeatures", "tzdb", "urca", "usethis", "utf8", "vctrs", "vegan", "viridis", "viridisLite", "vroom", "waldo", "whisker", "xfun", "xml2", "xts", "yaml", "zip"))
install.packages(c("alphavantager", "bayesm", "bayestestR", "bestNormalize", "BH", "bit", "blob", "boot", "brew", "broom", "bslib", "butcher", "cachem", "callr", "car", "checkmate", "class", "cli", "cluster", "codetools", "colorspace", "colourpicker", "commonmark", "compositions", "cpp11", "crayon", "curl", "data.table", "datawizard", "DBI", "dbplyr", "deldir", "dendextend", "DEoptimR", "desc", "devtools", "digest", "doRNG", "dplyr", "DT", "dtplyr", "e1071", "effectsize", "ellipse", "errors", "evaluate", "FactoMineR", "fansi", "farver", "fastmap", "fontawesome", "forcats", "forecast", "foreign", "Formula", "fracdiff", "fs", "furrr", "future", "future.apply", "gargle", "generics", "gert", "ggcorrplot", "ggfortify", "ggplot2", "ggpubr", "ggrepel", "ggsci", "ggsignif", "ggstance", "gh", "gitcreds", "globals", "googledrive", "googlesheets4", "gower", "greybox", "gtable", "hardhat", "haven", "highr", "Hmisc", "hms", "htmlTable", "htmltools", "htmlwidgets", "httpuv", "httr", "insight", "IntCal", "ipred", "isoband", "itraxR", "janitor", "jpeg", "jsonlite", "KernSmooth", "knitr", "LambertW", "lamW", "later", "lattice", "latticeExtra", "lava", "lifecycle", "listenv", "lme4", "lobstr", "lubridate", "maptools", "MASS", "Matrix", "MatrixModels", "mclust", "mgcv", "minqa", "mnormt", "modelr", "nlme", "nnet", "openssl", "ordr", "padr", "parallelly", "parameters", "patchwork", "pbkrtest", "pcaPP", "performance", "pillar", "pkgbuild", "pkgload", "pls", "plyr", "png", "polyclip", "pracma", "processx", "prodlim", "progressr", "proxy", "ps", "psych", "purrr", "quantmod", "quantreg", "R.cache", "R.methodsS3", "R.oo", "R.utils", "rbacon", "rcarbon", "Rcpp", "RcppArmadillo", "RcppEigen", "RcppParallel", "readr", "readxl", "recipes", "repr", "reprex", "rioja", "rlang", "rmarkdown", "robustbase", "roxygen2", "rpart", "rsample", "rstatix", "rstudioapi", "rversions", "rvest", "sass", "scales", "scatterplot3d", "see", "shiny", "slider", "smooth", "sourcetools", "sp", "spatial", "spatstat", "spatstat.data", "spatstat.geom", "spatstat.linnet", "spatstat.random", "spatstat.sparse", "spatstat.utils", "statmod", "stringi", "stringr", "styler", "survival", "sys", "testthat", "tibble", "tidypaleo", "tidyquant", "tidyr", "tidyselect", "tidyverse", "timeDate", "timetk", "tinytex", "tseries", "tsfeatures", "tzdb", "urca", "usethis", "utf8", "vctrs", "vegan", "viridis", "viridisLite", "vroom", "waldo", "whisker", "xfun", "xml2", "xts", "yaml", "zip"))
install.packages(c("alphavantager", "bayesm", "bayestestR", "bestNormalize", "BH", "bit", "blob", "boot", "brew", "broom", "bslib", "butcher", "cachem", "callr", "car", "checkmate", "class", "cli", "cluster", "codetools", "colorspace", "colourpicker", "commonmark", "compositions", "cpp11", "crayon", "curl", "data.table", "datawizard", "DBI", "dbplyr", "deldir", "dendextend", "DEoptimR", "desc", "devtools", "digest", "doRNG", "dplyr", "DT", "dtplyr", "e1071", "effectsize", "ellipse", "errors", "evaluate", "FactoMineR", "fansi", "farver", "fastmap", "fontawesome", "forcats", "forecast", "foreign", "Formula", "fracdiff", "fs", "furrr", "future", "future.apply", "gargle", "generics", "gert", "ggcorrplot", "ggfortify", "ggplot2", "ggpubr", "ggrepel", "ggsci", "ggsignif", "ggstance", "gh", "gitcreds", "globals", "googledrive", "googlesheets4", "gower", "greybox", "gtable", "hardhat", "haven", "highr", "Hmisc", "hms", "htmlTable", "htmltools", "htmlwidgets", "httpuv", "httr", "insight", "IntCal", "ipred", "isoband", "itraxR", "janitor", "jpeg", "jsonlite", "KernSmooth", "knitr", "LambertW", "lamW", "later", "lattice", "latticeExtra", "lava", "lifecycle", "listenv", "lme4", "lobstr", "lubridate", "maptools", "MASS", "Matrix", "MatrixModels", "mclust", "mgcv", "minqa", "mnormt", "modelr", "nlme", "nnet", "openssl", "ordr", "padr", "parallelly", "parameters", "patchwork", "pbkrtest", "pcaPP", "performance", "pillar", "pkgbuild", "pkgload", "pls", "plyr", "png", "polyclip", "pracma", "processx", "prodlim", "progressr", "proxy", "ps", "psych", "purrr", "quantmod", "quantreg", "R.cache", "R.methodsS3", "R.oo", "R.utils", "rbacon", "rcarbon", "Rcpp", "RcppArmadillo", "RcppEigen", "RcppParallel", "readr", "readxl", "recipes", "repr", "reprex", "rioja", "rlang", "rmarkdown", "robustbase", "roxygen2", "rpart", "rsample", "rstatix", "rstudioapi", "rversions", "rvest", "sass", "scales", "scatterplot3d", "see", "shiny", "slider", "smooth", "sourcetools", "sp", "spatial", "spatstat", "spatstat.data", "spatstat.geom", "spatstat.linnet", "spatstat.random", "spatstat.sparse", "spatstat.utils", "statmod", "stringi", "stringr", "styler", "survival", "sys", "testthat", "tibble", "tidypaleo", "tidyquant", "tidyr", "tidyselect", "tidyverse", "timeDate", "timetk", "tinytex", "tseries", "tsfeatures", "tzdb", "urca", "usethis", "utf8", "vctrs", "vegan", "viridis", "viridisLite", "vroom", "waldo", "whisker", "xfun", "xml2", "xts", "yaml", "zip"))
install.packages(c("alphavantager", "bayesm", "bayestestR", "bestNormalize", "BH", "bit", "blob", "boot", "brew", "broom", "bslib", "butcher", "cachem", "callr", "car", "checkmate", "class", "cli", "cluster", "codetools", "colorspace", "colourpicker", "commonmark", "compositions", "cpp11", "crayon", "curl", "data.table", "datawizard", "DBI", "dbplyr", "deldir", "dendextend", "DEoptimR", "desc", "devtools", "digest", "doRNG", "dplyr", "DT", "dtplyr", "e1071", "effectsize", "ellipse", "errors", "evaluate", "FactoMineR", "fansi", "farver", "fastmap", "fontawesome", "forcats", "forecast", "foreign", "Formula", "fracdiff", "fs", "furrr", "future", "future.apply", "gargle", "generics", "gert", "ggcorrplot", "ggfortify", "ggplot2", "ggpubr", "ggrepel", "ggsci", "ggsignif", "ggstance", "gh", "gitcreds", "globals", "googledrive", "googlesheets4", "gower", "greybox", "gtable", "hardhat", "haven", "highr", "Hmisc", "hms", "htmlTable", "htmltools", "htmlwidgets", "httpuv", "httr", "insight", "IntCal", "ipred", "isoband", "itraxR", "janitor", "jpeg", "jsonlite", "KernSmooth", "knitr", "LambertW", "lamW", "later", "lattice", "latticeExtra", "lava", "lifecycle", "listenv", "lme4", "lobstr", "lubridate", "maptools", "MASS", "Matrix", "MatrixModels", "mclust", "mgcv", "minqa", "mnormt", "modelr", "nlme", "nnet", "openssl", "ordr", "padr", "parallelly", "parameters", "patchwork", "pbkrtest", "pcaPP", "performance", "pillar", "pkgbuild", "pkgload", "pls", "plyr", "png", "polyclip", "pracma", "processx", "prodlim", "progressr", "proxy", "ps", "psych", "purrr", "quantmod", "quantreg", "R.cache", "R.methodsS3", "R.oo", "R.utils", "rbacon", "rcarbon", "Rcpp", "RcppArmadillo", "RcppEigen", "RcppParallel", "readr", "readxl", "recipes", "repr", "reprex", "rioja", "rlang", "rmarkdown", "robustbase", "roxygen2", "rpart", "rsample", "rstatix", "rstudioapi", "rversions", "rvest", "sass", "scales", "scatterplot3d", "see", "shiny", "slider", "smooth", "sourcetools", "sp", "spatial", "spatstat", "spatstat.data", "spatstat.geom", "spatstat.linnet", "spatstat.random", "spatstat.sparse", "spatstat.utils", "statmod", "stringi", "stringr", "styler", "survival", "sys", "testthat", "tibble", "tidypaleo", "tidyquant", "tidyr", "tidyselect", "tidyverse", "timeDate", "timetk", "tinytex", "tseries", "tsfeatures", "tzdb", "urca", "usethis", "utf8", "vctrs", "vegan", "viridis", "viridisLite", "vroom", "waldo", "whisker", "xfun", "xml2", "xts", "yaml", "zip"))
install.packages(c("alphavantager", "bayesm", "bayestestR", "bestNormalize", "BH", "bit", "blob", "boot", "brew", "broom", "bslib", "butcher", "cachem", "callr", "car", "checkmate", "class", "cli", "cluster", "codetools", "colorspace", "colourpicker", "commonmark", "compositions", "cpp11", "crayon", "curl", "data.table", "datawizard", "DBI", "dbplyr", "deldir", "dendextend", "DEoptimR", "desc", "devtools", "digest", "doRNG", "dplyr", "DT", "dtplyr", "e1071", "effectsize", "ellipse", "errors", "evaluate", "FactoMineR", "fansi", "farver", "fastmap", "fontawesome", "forcats", "forecast", "foreign", "Formula", "fracdiff", "fs", "furrr", "future", "future.apply", "gargle", "generics", "gert", "ggcorrplot", "ggfortify", "ggplot2", "ggpubr", "ggrepel", "ggsci", "ggsignif", "ggstance", "gh", "gitcreds", "globals", "googledrive", "googlesheets4", "gower", "greybox", "gtable", "hardhat", "haven", "highr", "Hmisc", "hms", "htmlTable", "htmltools", "htmlwidgets", "httpuv", "httr", "insight", "IntCal", "ipred", "isoband", "itraxR", "janitor", "jpeg", "jsonlite", "KernSmooth", "knitr", "LambertW", "lamW", "later", "lattice", "latticeExtra", "lava", "lifecycle", "listenv", "lme4", "lobstr", "lubridate", "maptools", "MASS", "Matrix", "MatrixModels", "mclust", "mgcv", "minqa", "mnormt", "modelr", "nlme", "nnet", "openssl", "ordr", "padr", "parallelly", "parameters", "patchwork", "pbkrtest", "pcaPP", "performance", "pillar", "pkgbuild", "pkgload", "pls", "plyr", "png", "polyclip", "pracma", "processx", "prodlim", "progressr", "proxy", "ps", "psych", "purrr", "quantmod", "quantreg", "R.cache", "R.methodsS3", "R.oo", "R.utils", "rbacon", "rcarbon", "Rcpp", "RcppArmadillo", "RcppEigen", "RcppParallel", "readr", "readxl", "recipes", "repr", "reprex", "rioja", "rlang", "rmarkdown", "robustbase", "roxygen2", "rpart", "rsample", "rstatix", "rstudioapi", "rversions", "rvest", "sass", "scales", "scatterplot3d", "see", "shiny", "slider", "smooth", "sourcetools", "sp", "spatial", "spatstat", "spatstat.data", "spatstat.geom", "spatstat.linnet", "spatstat.random", "spatstat.sparse", "spatstat.utils", "statmod", "stringi", "stringr", "styler", "survival", "sys", "testthat", "tibble", "tidypaleo", "tidyquant", "tidyr", "tidyselect", "tidyverse", "timeDate", "timetk", "tinytex", "tseries", "tsfeatures", "tzdb", "urca", "usethis", "utf8", "vctrs", "vegan", "viridis", "viridisLite", "vroom", "waldo", "whisker", "xfun", "xml2", "xts", "yaml", "zip"))
# clear previous console
remove (list = ls())
# clear plot window (if needed)
dev.off()
# load packages needed
library(tidyverse) # R working environment - better/easier than base R
library(PeriodicTable) # list of all elements in periodic table
library(compositions) # package for analysing geochemcial compositional data
# Set working directory (example for Steve’s folder structure - replace with your own folder structure)
# setwd("D:/Dropbox/BAS/Data/R/Papers/Bertrand_2022/Data") # windows
setwd("/Users/sjro/Dropbox/BAS/Data/R/Papers/Bertrand_2022/Data") # mac
# Use PeriodicTable package to make 'elementsList' of elements to use from imported dataset (then unload the package)
data(periodicTable)
elementsList <- periodicTable$symb
rm(periodicTable)
# Import data
Chile_xrf <- read_csv("Bertrand_Chile1.csv")
Chile_xrf
# Apply clr
Chile_xrf_clr0 <- Chile_xrf %>%
select(any_of(elementsList)) %>% # remove non element and scatter columns
mutate_at(vars(any_of(elementsList)), ## Replace zeros in each data column with half minimum value to allow linear modelling to work
~ (. == 0) * min(.[. != 0])/2 + .) %>% # Recommended procedure from Bertrand et al. (submitted) - retains dataframe structure
#mutate_if(is.numeric, ~na_if(., 0)) %>%  # alternate method - replace any remaining zeroes with NA – comment out mutate code line above if using this
#filter(!if_any(everything(), is.na)) %>% # alternate method - remove rows with NAs – comment out mutate code line above if using this
clr()
# Check sum = zero
Chile_xrf_clr0 <- as_tibble(Chile_xrf_clr0) %>%
mutate(checksum = rowSums(across(any_of(elementsList)))) %>%
mutate_if(is.numeric, round, digits = 3) # round to 3 d.p.
# Add depth column from original dataframe to clr dataframe
Chile_xrf_depth <- Chile_xrf %>%
#mutate_if(is.numeric, ~na_if(., 0)) %>%  # alternate method - replace any zeroes with NA to match alternate method dataframe structure
#filter(!if_any(everything(), is.na)) %>% # alternate method - remove rows with NAs to match alternate method dataframe structure
select(Depth_cm)
Chile_xrf_clr <-bind_cols(Chile_xrf_depth, Chile_xrf_clr0)
Chile_xrf_clr
# Save output to file in current working directory
write.csv(Chile_xrf_clr,"Bertrand_Chile1_clr.csv", row.names = FALSE)
